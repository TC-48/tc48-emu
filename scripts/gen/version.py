#!/usr/bin/env python3
import sys
import re
from pathlib import Path

def main() -> int:
    version_file = Path("VERSION")
    if not version_file.exists():
        print(f"Error: {version_file} not found", file=sys.stderr)
        return 1

    version_text = version_file.read_text().strip()
    match = re.match(r"^(\d+)\.(\d+)\.(\d+)$", version_text)

    if not match:
        print(f"Error: Invalid VERSION format in {version_file}", file=sys.stderr)
        return 1

    major, minor, patch = map(int, match.groups())

    print("// NOTE: this file is auto-generated by scripts/gen/version.py")
    print("//       do not modify this file directly")
    print("#pragma once")
    print()
    print(f'#define TC48_VERSION_MAJOR {major}')
    print(f'#define TC48_VERSION_MINOR {minor}')
    print(f'#define TC48_VERSION_PATCH {patch}')
    print(f'#define TC48_VERSION_STRING "{version_text}"')

    return 0

if __name__ == "__main__":
    sys.exit(main())
